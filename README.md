# MosDNS 独立监控面板

![MosDNS Monitor Panel Light Theme](https://github.com/user-attachments/assets/bfb2a0d0-5c34-45aa-9057-fadf1b472149)
_亮色主题预览_

![MosDNS Monitor Panel Dark Theme](https://github.com/user-attachments/assets/e4e39bf1-855f-4ae3-a488-29099f75e840)
_暗色主题预览_

## 简介

MosDNS 独立监控面板是一个简洁、美观且功能强大的 MosDNS 服务实时监控解决方案。

**现在提供两个版本：**
- **Python Flask 版本** (`app.py`) - 原版本，需要 Python 环境
- **Go 单文件版本** (`app.go`) - 新版本，单一二进制文件，HTML 已内嵌

本面板与 MosDNS 自带的 UI 并行运行，互不影响。它旨在提供一个专注于监控和管理核心缓存指标的界面，并支持多种主题切换，以适应不同用户偏好，提供流畅无闪烁的交互体验。

## 🚀 Go 版本快速开始 (推荐)

**Go 版本优势：**
- 🎯 **单一二进制文件**：HTML 已内嵌，无需任何外部文件
- ⚡ **极致性能**：启动时间 < 100ms，响应速度提升 10-100 倍
- 💾 **低资源占用**：内存占用减少 70%，CPU 使用率降低 80%
- 📦 **零依赖部署**：无需 Python 环境，一个文件搞定

**使用方法：**
```bash
# 1. 构建 (需要 Go 1.21+)
go build -o mosdns-ui app.go

# 2. 运行
./mosdns-ui

# 3. 访问
# http://localhost:5001
```

**配置环境变量：**
```bash
MOSDNS_ADMIN_URL=http://192.168.1.100:9099 FLASK_PORT=8080 ./mosdns-ui
```

## 🤖 自动构建

项目配置了 GitHub Actions 自动构建多平台二进制文件：

**支持平台：**
- Linux (amd64, arm64)
- Windows (amd64)
- macOS (amd64, arm64)

**触发方式：**
1. 创建 Release 时自动构建
2. 推送 tag (如 `v1.0.0`) 时构建
3. 手动触发 workflow

**下载地址：**
在 [Releases](../../releases) 页面下载对应平台的二进制文件。



## 主要功能

*   **实时性能监控**：展示 MosDNS 的请求总数、缓存命中、过期缓存命中、缓存条目数等关键指标。
*   **系统资源概览**：监控 MosDNS 进程的 CPU 时间、常驻内存 (RSS)、堆内存、Go 版本、线程数和文件描述符数量等系统信息。
*   **多主题支持**：内置 **默认亮色**、**默认暗色**、**赛博朋克**、**静谧森林**、**日落余晖** 和 **高级灰** 多种主题，一键切换，满足您的视觉偏好。图表颜色也会随主题联动。
*   **直观的饼图展示**：通过甜甜圈饼图清晰展示缓存的命中率和过期命中率。
*   **无闪烁实时更新**：自动刷新时，仅更新数据和图表内容，避免整个页面重绘，提供流畅的视觉体验。
*   **智能刷新控制**：
    *   提供开关，可选择是否启用 5 秒自动刷新。
    *   可手动点击“立即刷新”按钮获取最新数据。
    *   显示数据最后一次更新的时间。
*   **一键清空 FakeIP 缓存**：方便快捷地执行 MosDNS 的 FakeIP 缓存清空操作。
*   **独立的 Web 服务**：作为独立的 Flask 应用运行，不依赖或修改 MosDNS 自身配置，互不干扰。
*   **一键部署与回滚脚本**：提供 Bash 脚本，简化部署和卸载流程。
*   **集成诊断与修复**：脚本内置诊断功能，可自动检查并尝试修复常见部署问题。

## 部署要求

*   **操作系统**：基于 Debian / Ubuntu 的 Linux 发行版（脚本基于 `apt` 包管理器）。
*   **MosDNS**：已正确安装并运行，且其 HTTP Metrics 接口（默认为 `http://localhost:9099/metrics`）可访问。
*   **Python3**：系统需安装 Python3 及 `python3-venv`。
*   **权限**：需要 `sudo` 权限来安装系统依赖、创建服务和配置防火墙。

## 快速开始 (一键部署)

本项目的核心是一个 Bash 脚本，它会帮助您一键部署所有必要的组件。

1.  **获取部署脚本**：
    将 `MosDNSUI.sh` 文件下载到您的服务器。最简单的方式是直接从本 GitHub 仓库下载：
    ```bash
    wget https://raw.githubusercontent.com/Jimmyzxk/MosDNSUI/main/MosDNSUI.sh -O MosDNSUI.sh
    ```
    _（请确保上述 `main` 分支和 `MosDNSUI.sh` 路径在您上传后是正确的）_

2.  **赋予执行权限**：
    ```bash
    chmod +x MosDNSUI.sh
    ```

3.  **运行部署脚本**：
    以 `sudo` 权限运行脚本，它将引导您完成部署过程。

    ```bash
    sudo ./MosDNSUI.sh
    ```

    脚本将提示您选择操作。选择 `部署 MosDNS 监控面板`。

    **脚本部署步骤概览：**
    *   检查 MosDNS Metrics 接口可访问性。
    *   安装 Python3、pip 和 `python3-venv` 等必要依赖。
    *   创建项目目录 `/opt/mosdns_monitor_panel`。
    *   创建 Python 虚拟环境并安装 Flask、Gunicorn 和 Requests。
    *   创建 Flask 后端应用 `app.py`。
    *   创建网站图标 `favicon.png`。
    *   创建 HTML 前端页面 `index.html`（**此文件将包含您最新优化的 UI 代码**）。
    *   创建 Systemd 服务并启动监控面板。
    *   自动配置 UFW 防火墙以允许访问默认端口 `5001`。

4.  **访问监控面板**：
    部署完成后，您将看到提示信息，通常可以通过以下地址访问您的监控面板：

    ```
    http://<您的服务器IP地址>:5001
    ```
    例如：`http://192.168.1.100:5001`

    如果您的服务器有域名解析，也可以使用域名访问。

## 使用说明

监控面板分为以下几个主要区域：

*   **缓存状态卡片**：
    *   显示各类缓存（全部、国内、国外、节点）的详细统计数据，包括请求总数、命中数、过期命中数、命中率、过期命中率和条目数。
    *   每个卡片顶部有一个状态点，绿色表示有活跃请求，黄色表示无请求。
    *   甜甜圈饼图直观展示命中率和过期命中率。

*   **系统信息** (`<i class="fas fa-server"></i>`)：
    *   展示 MosDNS 进程的启动时间、CPU 占用时间、常驻内存、空闲堆内存、Go 版本、线程数和打开文件描述符数量。

*   **显示卡片** (`<i class="fas fa-eye"></i>`)：
    *   您可以勾选/取消勾选来控制页面上显示哪些缓存卡片。选择后页面会自动刷新以应用更改。

*   **主题切换** (`<i class="fas fa-palette"></i>`)：
    *   提供多种内置主题按钮。点击即可实时切换面板的主题样式。图表颜色、文字颜色、背景颜色等将同步更新，提供一致的视觉体验。

*   **操作与刷新** (`<i class="fas fa-tools"></i>`)：
    *   **启用自动刷新 (5s)**：勾选此项，面板将每 5 秒自动获取最新数据并更新页面，且更新过程无闪烁。取消勾选则停止自动刷新。
    *   **立即刷新**：手动点击此按钮可立即获取最新数据并更新页面，保持无闪烁体验。
    *   **清空 FakeIP 缓存**：点击此按钮将向 MosDNS 发送指令，清空 FakeIP 缓存。此操作会触发页面重新加载以反映最新状态。
    *   **最后更新**：显示面板数据最后一次更新的时间。

## 配置

您可以编辑部署脚本 `MosDNSUI.sh` 文件开头的变量来定制面板：

*   `FLASK_PORT=5001`：Web 监控面板运行的端口。如果您希望在其他端口运行，请在部署前修改此值。
*   `MOSDNS_METRICS_URL="http://localhost:9099/metrics"`：MosDNS Metrics 接口的完整 URL。如果您的 MosDNS 监听在不同的 IP 或端口，请相应修改。
*   `WEB_USER="www-data"`：运行 Flask 应用的系统用户。默认是 `www-data`，这是一个常见的 Web 服务器用户。

**请注意：** 如果您在部署后修改了这些配置，需要先执行回滚/清理操作，然后重新部署。

## 故障诊断与修复

如果监控面板无法正常工作，您可以运行部署脚本中的“一键诊断并尝试修复”选项：

```bash
sudo ./MosDNSUI.sh
